var app=angular.module("autocomplete",[]);app.directive("autocomplete",function(){var a=-1;return{restrict:"E",scope:{searchParam:"=ngModel",suggestions:"=data",onType:"=onType",onSelect:"=onSelect",autocompleteRequired:"="},controller:["$scope",function(a){a.selectedIndex=-1,a.initLock=!0,a.setIndex=function(b){a.selectedIndex=parseInt(b)},this.setIndex=function(b){a.setIndex(b),a.$apply()},a.getIndex=function(b){return a.selectedIndex};var b=!0;a.completing=!1,a.$watch("searchParam",function(c,d){d===c||!d&&a.initLock||(b&&"undefined"!=typeof a.searchParam&&null!==a.searchParam&&(a.completing=!0,a.searchFilter=a.searchParam,a.selectedIndex=-1),a.onType&&a.onType(a.searchParam))}),this.preSelect=function(c){b=!1,a.$apply(),b=!0},a.preSelect=this.preSelect,this.preSelectOff=function(){b=!0},a.preSelectOff=this.preSelectOff,a.select=function(c){c&&(a.searchParam=c,a.searchFilter=c,a.onSelect&&a.onSelect(c)),b=!1,a.completing=!1,setTimeout(function(){b=!0},1e3),a.setIndex(-1)}}],link:function(b,c,d){setTimeout(function(){b.initLock=!1,b.$apply()},250);var e="";b.attrs={placeholder:"start typing...","class":"",id:"",inputclass:"",inputid:""};for(var f in d)e=f.replace("attr","").toLowerCase(),0===f.indexOf("attr")&&(b.attrs[e]=d[f]);d.clickActivation&&(c[0].onclick=function(a){b.searchParam||setTimeout(function(){b.completing=!0,b.$apply()},200)});var g={left:37,up:38,right:39,down:40,enter:13,esc:27,tab:9};document.addEventListener("keydown",function(a){var c=a.keyCode||a.which;switch(c){case g.esc:b.select(),b.setIndex(-1),b.$apply(),a.preventDefault()}},!0),document.addEventListener("blur",function(a){setTimeout(function(){b.select(),b.setIndex(-1),b.$apply()},150)},!0),c[0].addEventListener("keydown",function(c){var d=c.keyCode||c.which,e=angular.element(this).find("li").length;if(b.completing&&0!=e)switch(d){case g.up:if(a=b.getIndex()-1,-1>a)a=e-1;else if(a>=e){a=-1,b.setIndex(a),b.preSelectOff();break}b.setIndex(a),-1!==a&&b.preSelect(angular.element(angular.element(this).find("li")[a]).text()),b.$apply();break;case g.down:if(a=b.getIndex()+1,-1>a)a=e-1;else if(a>=e){a=-1,b.setIndex(a),b.preSelectOff(),b.$apply();break}b.setIndex(a),-1!==a&&b.preSelect(angular.element(angular.element(this).find("li")[a]).text());break;case g.left:break;case g.right:case g.enter:case g.tab:a=b.getIndex(),-1!==a?(b.select(angular.element(angular.element(this).find("li")[a]).text()),d==g.enter&&c.preventDefault()):d==g.enter&&b.select(),b.setIndex(-1),b.$apply();break;case g.esc:b.select(),b.setIndex(-1),b.$apply(),c.preventDefault();break;default:return}})},template:'        <div class="autocomplete {{ attrs.class }}" id="{{ attrs.id }}">          <input            type="text"            ng-model="searchParam"            placeholder="{{ attrs.placeholder }}"            class="{{ attrs.inputclass }}"            id="{{ attrs.inputid }}"            ng-required="{{ autocompleteRequired }}" />          <ul ng-show="completing && (suggestions | filter:searchFilter).length > 0">            <li              suggestion              ng-repeat="suggestion in suggestions | filter:searchFilter | orderBy:\'toString()\' track by $index"              index="{{ $index }}"              val="{{ suggestion }}"              ng-class="{ active: ($index === selectedIndex) }"              ng-click="select(suggestion)"              ng-bind-html="suggestion | highlight:searchParam"></li>          </ul>        </div>'}}),app.filter("highlight",["$sce",function(a){return function(b,c){if("function"==typeof b)return"";if(c){var d="("+c.split(/\ /).join(" |")+"|"+c.split(/\ /).join("|")+")",e=new RegExp(d,"gi");d.length&&(b=b.replace(e,'<span class="highlight">$1</span>'))}return a.trustAsHtml(b)}}]),app.directive("suggestion",function(){return{restrict:"A",require:"^autocomplete",link:function(a,b,c,d){b.bind("mouseenter",function(){d.preSelect(c.val),d.setIndex(c.index)}),b.bind("mouseleave",function(){d.preSelectOff()})}}}),!function(a,b){"object"==typeof exports?module.exports=b(require("angular")):"function"==typeof define&&define.amd?define(["angular"],b):b(a.angular)}(this,function(a){"use strict";a.module("ngWYSIWYG",["ngSanitize"]),a.module("ngWYSIWYG").config(["$provide",function(a){a.decorator("$sanitize",["$delegate","$log",function(a,b){return function(b,c){var d=a(b,c);return d}}])}]),a.module("ngWYSIWYG").constant("NGP_EVENTS",{ELEMENT_CLICKED:"ngp-element-clicked",CLICK_AWAY:"ngp-click-away"}),a.module("ngWYSIWYG").directive("ngpColorsGrid",["NGP_EVENTS",function(a){var b=function(b,c){b.$on(a.CLICK_AWAY,function(){b.$apply(function(){b.show=!1})}),c.parent().bind("click",function(a){a.stopPropagation()}),b.colors=["#000000","#993300","#333300","#003300","#003366","#000080","#333399","#333333","#800000","#FF6600","#808000","#008000","#008080","#0000FF","#666699","#808080","#FF0000","#FF9900","#99CC00","#339966","#33CCCC","#3366FF","#800080","#999999","#FF00FF","#FFCC00","#FFFF00","#00FF00","#00FFFF","#00CCFF","#993366","#C0C0C0","#FF99CC","#FFCC99","#FFFF99","#CCFFCC","#CCFFFF","#99CCFF","#CC99FF","#FFFFFF"],b.pick=function(a){b.onPick({color:a})},c.ready(function(){function a(b){1==b.nodeType&&(b.setAttribute("unselectable","on"),b.unselectable="on");for(var c=b.firstChild;c;)a(c),c=c.nextSibling}for(var b=0;b<document.getElementsByClassName("ngp-colors-grid").length;b+=1)a(document.getElementsByClassName("ngp-colors-grid")[b])})};return{link:b,scope:{show:"=",onPick:"&"},restrict:"AE",template:'<ul ng-show="show" class="ngp-colors-grid"><li ng-style="{\'background-color\': color}" title: "{{color}}" ng-repeat="color in colors" unselectable="on" ng-click="pick(color)"></li></ul>'}}]),a.module("ngWYSIWYG").directive("ngpSymbolsGrid",["NGP_EVENTS",function(a){var b=function(b,c){b.$on(a.CLICK_AWAY,function(){b.$apply(function(){b.show=!1})}),c.parent().bind("click",function(a){a.stopPropagation()}),b.symbols=["&iexcl;","&iquest;","&ndash;","&mdash;","&raquo;","&laquo;","&copy;","&divide;","&micro;","&para;","&plusmn;","&cent;","&euro;","&pound;","&reg;","&sect;","&trade;","&yen;","&deg;","&forall;","&part;","&exist;","&empty;","&nabla;","&isin;","&notin;","&ni;","&prod;","&sum;","&uarr;","&rarr;","&darr;","&spades;","&clubs;","&hearts;","&diams;","&aacute;","&agrave;","&acirc;","&aring;","&atilde;","&auml;","&aelig;","&ccedil;","&eacute;","&egrave;","&ecirc;","&euml;","&iacute;","&igrave;","&icirc;","&iuml;","&ntilde;","&oacute;","&ograve;","&ocirc;","&oslash;","&otilde;","&ouml;","&szlig;","&uacute;","&ugrave;","&ucirc;","&uuml;","&yuml;"],b.pick=function(a){b.onPick({symbol:a})},c.ready(function(){function a(b){1==b.nodeType&&(b.setAttribute("unselectable","on"),b.unselectable="on");for(var c=b.firstChild;c;)a(c),c=c.nextSibling}for(var b=0;b<document.getElementsByClassName("ngp-symbols-grid").length;b+=1)a(document.getElementsByClassName("ngp-symbols-grid")[b])})};return{link:b,scope:{show:"=",onPick:"&"},restrict:"AE",template:'<ul ng-show="show" class="ngp-symbols-grid"><li ng-repeat="symbol in symbols" unselectable="on" ng-click="pick(symbol)" ng-bind-html="symbol"></li></ul>'}}]),a.module("ngWYSIWYG").service("ngpImageResizer",["NGP_EVENTS",function(a){function b(a){a.preventDefault()}function c(a){a.preventDefault(),a.stopPropagation(),s.style.height="",s.style.width="",h()}function d(a){a.preventDefault(),a.stopPropagation(),s.style.width="100%",s.style.height="",h()}function e(a){return a.target!=p?(j.removeEventListener("mousemove",f),void(r=!1)):(a.stopPropagation(),a.preventDefault(),j.addEventListener("mousemove",f),void(r=!0))}function f(a){a.stopPropagation(),a.preventDefault();var b=a.pageY,c=b-(s.getBoundingClientRect().top+k.pageYOffset);s.style.height=c+"px",s.style.width="",n&&a.clientY>n&&k.innerHeight-a.clientY<=45&&k.scrollTo(0,k.innerHeight),n=a.clientY,h()}function g(a,b){return b==m||r?void j.removeEventListener("mousemove",f):"IMG"!==b.tagName?i():(m.parentNode||l.appendChild(m),s=b,void h())}function h(){var a=k.getComputedStyle(s);m.style.height=a.getPropertyValue("height"),m.style.width=a.getPropertyValue("width"),m.style.top=s.getBoundingClientRect().top+k.pageYOffset+"px",m.style.left=s.getBoundingClientRect().left+k.pageXOffset+"px",m.style.display="block"}function i(a){m.parentNode&&(a&&"IMG"===a.target.tagName||(m.style.display="none",n=null))}var j,k,l,m,n,o,p,q,r,s,t=this;t.setup=function(f,h){k=h.defaultView,j=h,l=j.querySelector("body"),o=f,m=j.createElement("div"),m.className="ngp-image-resizer",m.style.position="absolute",m.style.border="1px dashed black",m.style.display="none",m.setAttribute("contenteditable",!1),p=j.createElement("div"),p.style.position="absolute",p.style.height="10px",p.style.width="10px",p.style.bottom="-5px",p.style.right="-5px",p.style.border="1px solid black",p.style.backgroundColor="#fff",p.style.cursor="se-resize",p.setAttribute("contenteditable",!1),m.appendChild(p),q=j.createElement("div"),q.style.position="absolute",q.style.height="30px",q.style.width="150px",q.style.bottom="-30px",q.style.left="0",m.appendChild(q);var n=j.createElement("button");n.addEventListener("click",c),n.innerHTML="Auto",q.appendChild(n);var r=j.createElement("button");r.addEventListener("click",d),r.innerHTML="100%",q.appendChild(r),j.addEventListener("mousedown",e),j.addEventListener("mouseup",e),k.parent.document.addEventListener("mouseup",e),l.addEventListener("mscontrolselect",b),o.$on(a.ELEMENT_CLICKED,g),o.$on(a.CLICK_AWAY,i)}}]);var b='<div class="tinyeditor"><div class="tinyeditor-header" ng-hide="editMode">{toolbar}<div style="clear: both;"></div></div><div class="sizer" ngp-resizable><textarea data-placeholder-attr="" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; resize: none; width: 100%; height: 100%;" ng-show="editMode" ng-model="content"></textarea><iframe style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; width: 100%; height: 100%;" ng-hide="editMode" ngp-content-frame="{sanitize: config.sanitize}" content-style="{contentStyle}" ng-model="content"></iframe></div><div class="tinyeditor-footer"><div ng-switch="editMode" ng-click="editMode = !editMode" class="toggle"><span ng-switch-when="true">wysiwyg</span><span ng-switch-default>source</span></div></div></div>';return a.module("ngWYSIWYG").directive("wysiwygEdit",["ngpUtils","NGP_EVENTS","$rootScope","$compile","$timeout","$q",function(c,d,e,f,g,h){var i=function(g,i,j,k){function l(){null==o&&(o=document.querySelector("wysiwyg-edit").querySelector("iframe"),p=o.contentDocument,q=p.defaultView)}function m(a){g.$broadcast("insertElement",a)}function n(a){var b="<"+a.type;if(b+=' class="'+a["class"],r&&(b+=" tinyeditor-control-fa"),b+='" ',"div"==a.type){if(a.title&&(b+='title="'+a.title+'" '),a.backgroundPos&&!r&&(b+='style="background-position: '+a.backgroundPos+'; position: relative;" '),a.pressed&&(b+="ng-class=\"{'pressed': cursorStyle."+a.pressed+'}" '),a.command){var c="'"+a.command+"'";a.commandParameter&&(c+=", '"+a.commandParameter+"'"),b+='ng-click="execCommand('+c+')" '}else a.specialCommand&&(b+='ng-click="'+a.specialCommand+'" ');b+=">",a.faIcon&&r&&"-"!=a.faIcon&&(b+='<i class="fa fa-'+a.faIcon+'"></i>'),a.faIcon&&r&&"-"==a.faIcon&&(b+='<div class="hr"></div>'),a.inner&&(b+=a.inner)}else"select"==a.type&&(b+='ng-model="'+a.model+'" ',b+='ng-options="'+a.options+'" ',b+='ng-change="'+a.change+'" ',b+='<option value="">'+a.title+"</option>");return b+="</"+a.type+">"}g.editMode=!1,g.cursorStyle={},document.addEventListener("click",function(){e.$broadcast(d.CLICK_AWAY)});var o=null,p=null,q=null;g.panelButtons={"-":{type:"div","class":"tinyeditor-divider"},bold:{type:"div",title:"Bold","class":"tinyeditor-control",faIcon:"bold",backgroundPos:"34px -120px",pressed:"bold",command:"bold"},italic:{type:"div",title:"Italic","class":"tinyeditor-control",faIcon:"italic",backgroundPos:"34px -150px",pressed:"italic",command:"italic"},underline:{type:"div",title:"Underline","class":"tinyeditor-control",faIcon:"underline",backgroundPos:"34px -180px",pressed:"underline",command:"underline"},strikethrough:{type:"div",title:"Strikethrough","class":"tinyeditor-control",faIcon:"strikethrough",backgroundPos:"34px -210px",pressed:"strikethrough",command:"strikethrough"},subscript:{type:"div",title:"Subscript","class":"tinyeditor-control",faIcon:"subscript",backgroundPos:"34px -240px",pressed:"sub",command:"subscript"},superscript:{type:"div",title:"Superscript","class":"tinyeditor-control",faIcon:"superscript",backgroundPos:"34px -270px",pressed:"super",command:"superscript"},leftAlign:{type:"div",title:"Left Align","class":"tinyeditor-control",faIcon:"align-left",backgroundPos:"34px -420px",pressed:"alignmet == 'left'",command:"justifyleft"},centerAlign:{type:"div",title:"Center Align","class":"tinyeditor-control",faIcon:"align-center",backgroundPos:"34px -450px",pressed:"alignment == 'center'",command:"justifycenter"},rightAlign:{type:"div",title:"Right Align","class":"tinyeditor-control",faIcon:"align-right",backgroundPos:"34px -480px",pressed:"alignment == 'right'",command:"justifyright"},blockJustify:{type:"div",title:"Block Justify","class":"tinyeditor-control",faIcon:"align-justify",backgroundPos:"34px -510px",pressed:"alignment == 'justify'",command:"justifyfull"},orderedList:{type:"div",title:"Insert Ordered List","class":"tinyeditor-control",faIcon:"list-ol",backgroundPos:"34px -300px",command:"insertorderedlist"},unorderedList:{type:"div",title:"Insert Unordered List","class":"tinyeditor-control",faIcon:"list-ul",backgroundPos:"34px -330px",command:"insertunorderedlist"},outdent:{type:"div",title:"Outdent","class":"tinyeditor-control",faIcon:"outdent",backgroundPos:"34px -360px",command:"outdent"},indent:{type:"div",title:"Indent","class":"tinyeditor-control",faIcon:"indent",backgroundPos:"34px -390px",command:"indent"},removeFormatting:{type:"div",title:"Remove Formatting","class":"tinyeditor-control",faIcon:"eraser",backgroundPos:"34px -720px",command:"removeformat"},undo:{type:"div",title:"Undo","class":"tinyeditor-control",faIcon:"undo",backgroundPos:"34px -540px",command:"undo"},redo:{type:"div",title:"Redo","class":"tinyeditor-control",faIcon:"repeat",backgroundPos:"34px -570px",command:"redo"},fontColor:{type:"div",title:"Font Color","class":"tinyeditor-control",faIcon:"font",backgroundPos:"34px -779px",specialCommand:"showFontColors = !showFontColors",inner:'<ngp-colors-grid show="showFontColors" on-pick="setFontColor(color)"><ngp-colors-grid>'},backgroundColor:{type:"div",title:"Background Color","class":"tinyeditor-control",faIcon:"paint-brush",backgroundPos:"34px -808px",specialCommand:"showBgColors = !showBgColors",inner:'<ngp-colors-grid show="showBgColors" on-pick="setBgColor(color)"><ngp-colors-grid>'},image:{type:"div",title:"Insert Image","class":"tinyeditor-control",faIcon:"picture-o",backgroundPos:"34px -600px",specialCommand:"insertImage()"},hr:{type:"div",title:"Insert Horizontal Rule","class":"tinyeditor-control",faIcon:"-",backgroundPos:"34px -630px",command:"inserthorizontalrule"},symbols:{type:"div",title:"Insert Special Symbol","class":"tinyeditor-control",faIcon:"cny",backgroundPos:"34px -838px",specialCommand:"showSpecChars = !showSpecChars",inner:'<ngp-symbols-grid show="showSpecChars" on-pick="insertSpecChar(symbol)"><ngp-symbols-grid>'},link:{type:"div",title:"Insert Hyperlink","class":"tinyeditor-control",faIcon:"link",backgroundPos:"34px -660px",specialCommand:"insertLink()"},unlink:{type:"div",title:"Remove Hyperlink","class":"tinyeditor-control",faIcon:"chain-broken",backgroundPos:"34px -690px",command:"unlink"},print:{type:"div",title:"Print","class":"tinyeditor-control",faIcon:"print",backgroundPos:"34px -750px",command:"print"},font:{type:"select",title:"Font","class":"tinyeditor-font",model:"font",options:"a as a for a in fonts",change:"fontChange()"},size:{type:"select",title:"Size","class":"tinyeditor-size",model:"fontsize",options:"a.key as a.name for a in fontsizes",change:"sizeChange()"},format:{type:"select",title:"Style","class":"tinyeditor-size",model:"textstyle",options:"s.key as s.name for s in styles",change:"styleChange()"}};var r=g.config&&g.config.fontAwesome;g.toolbar=g.config&&g.config.toolbar?g.config.toolbar:[{name:"basicStyling",items:["bold","italic","underline","strikethrough","subscript","superscript","leftAlign","centerAlign","rightAlign","blockJustify","-"]},{name:"paragraph",items:["orderedList","unorderedList","outdent","indent","-"]},{name:"doers",items:["removeFormatting","undo","redo","-"]},{name:"colors",items:["fontColor","backgroundColor","-"]},{name:"links",items:["image","hr","symbols","link","unlink","-"]},{name:"tools",items:["print","-"]},{name:"styling",items:["font","size","format"]}];var s=[];a.forEach(g.toolbar,function(b,c){var d=[];a.forEach(b.items,function(a,b){var c=g.panelButtons[a];c||(c=g.config.buttons[a]),this.push(n(c))},d),this.push('<div class="tinyeditor-buttons-group">'+d.join("")+"</div>")},s);var t=b.replace("{toolbar}",s.join(""));t=t.replace("{contentStyle}",j.contentStyle||""),i.html(t),f(i.contents())(g),g.execCommand=function(a,b){switch(a){case"bold":g.cursorStyle.bold=!g.cursorStyle.bold;break;case"italic":g.cursorStyle.italic=!g.cursorStyle.italic;break;case"underline":g.cursorStyle.underline=!g.cursorStyle.underline;break;case"strikethrough":g.cursorStyle.strikethrough=!g.cursorStyle.strikethrough;break;case"subscript":g.cursorStyle.sub=!g.cursorStyle.sub;break;case"superscript":g.cursorStyle["super"]=!g.cursorStyle["super"];break;case"justifyleft":g.cursorStyle.alignment="left";break;case"justifycenter":g.cursorStyle.alignment="center";break;case"justifyright":g.cursorStyle.alignment="right";break;case"justifyfull":g.cursorStyle.alignment="justify"}g.$broadcast("execCommand",{command:a,arg:b})},g.fonts=["Verdana","Arial","Arial Black","Arial Narrow","Courier New","Century Gothic","Comic Sans MS","Georgia","Impact","Tahoma","Times","Times New Roman","Webdings","Trebuchet MS"],g.fontChange=function(){g.execCommand("fontname",g.font)},g.fontsizes=[{key:1,name:"x-small"},{key:2,name:"small"},{key:3,name:"normal"},{key:4,name:"large"},{key:5,name:"x-large"},{key:6,name:"xx-large"},{key:7,name:"xxx-large"}],g.mapFontSize={10:1,13:2,16:3,18:4,24:5,32:6,48:7},g.sizeChange=function(){g.execCommand("fontsize",g.fontsize)},g.styles=[{name:"Paragraph",key:"<p>"},{name:"Header 1",key:"<h1>"},{name:"Header 2",key:"<h2>"},{name:"Header 3",key:"<h3>"},{name:"Header 4",key:"<h4>"},{name:"Header 5",key:"<h5>"},{name:"Header 6",key:"<h6>"}],g.styleChange=function(){g.execCommand("formatblock",g.textstyle)},g.showFontColors=!1,g.setFontColor=function(a){g.execCommand("foreColor",a)},g.showBgColors=!1,g.setBgColor=function(a){g.execCommand("hiliteColor",a)},g.showSpecChars=!1,g.insertSpecChar=function(a){m(a)},g.insertLink=function(){if(l(),null!=q.getSelection().focusNode){var b=c.getSelectionBoundaryElement(q,!0),d="http://";if(b&&"A"==b.nodeName){d=b.href;var e=p.createRange();e.setStart(b.firstChild,0),e.setEnd(b.firstChild,b.firstChild.length);var f=q.getSelection();f.removeAllRanges(),f.addRange(e)}var i;i=g.api&&g.api.insertLink&&a.isFunction(g.api.insertLink)?g.api.insertLink.apply(g.api.scope||null,[d]):prompt("Please enter the URL","http://"),h.when(i).then(function(a){g.execCommand("createlink",a)})}},g.insertImage=function(){var b;g.api&&g.api.insertImage&&a.isFunction(g.api.insertImage)?b=g.api.insertImage.apply(g.api.scope||null):(b=prompt("Please enter the picture URL","http://"),b='<img src="'+b+'">'),h.when(b).then(function(a){m(a)})},i.ready(function(){function a(b){1==b.nodeType&&(b.setAttribute("unselectable","on"),b.unselectable="on");for(var c=b.firstChild;c;)a(c),c=c.nextSibling}for(var b=0;b<document.getElementsByClassName("tinyeditor-header").length;b+=1)a(document.getElementsByClassName("tinyeditor-header")[b])}),g.$on("cursor-position",function(a,b){g.cursorStyle=b,g.font=b.font.replace(/(')/g,""),g.fontsize=g.mapFontSize[b.size]?g.mapFontSize[b.size]:0})};return{link:i,scope:{content:"=",api:"=",config:"="},restrict:"AE",replace:!0}}]),a.module("ngWYSIWYG").directive("ngpContentFrame",["ngpImageResizer","ngpUtils","NGP_EVENTS","$compile","$timeout","$sanitize",function(b,c,d,e,f,g){var h=function(e,h,i,j){var k=h[0].contentDocument;k.open(),k.write('<!DOCTYPE html><html><head></head><body contenteditable="true"></body></html>'),k.close(),k.designMode="On",b.setup(e,k);var l=a.element(h[0].contentDocument.body),m=a.element(h[0].contentDocument.head);l.attr("contenteditable","true"),k.addEventListener("click",function(a){"HTML"===a.target.tagName&&a.target.querySelector("body").focus(),e.$emit(d.ELEMENT_CLICKED,a.target)}),i.contentStyle&&m.append('<link rel="stylesheet" type="text/css" href="'+i.contentStyle+'">'),j.$render=function(){l[0].innerHTML=j.$viewValue?e.config&&e.config.sanitize?g(j.$viewValue):j.$viewValue:""},e.sync=function(){e.$evalAsync(function(a){j.$setViewValue(l.html())})};var n=null;l.bind("click keyup change paste",function(){n&&f.cancel(n),n=f(function(){var a=l[0].ownerDocument,b=a.querySelector(".ngp-image-resizer"),d=l[0].innerHTML;b&&(d=d.replace(b.outerHTML,"")),j.$setViewValue(d);var f=c.getSelectionBoundaryElement(h[0].contentWindow,!0);if(f){var g=h[0].contentWindow.getComputedStyle(f),i={bold:"bold"==g.getPropertyValue("font-weight")||parseInt(g.getPropertyValue("font-weight"))>=700,italic:"italic"==g.getPropertyValue("font-style"),underline:"underline"==g.getPropertyValue("text-decoration"),strikethrough:"line-through"==g.getPropertyValue("text-decoration"),font:g.getPropertyValue("font-family"),size:parseInt(g.getPropertyValue("font-size")),color:g.getPropertyValue("color"),sub:"sub"==g.getPropertyValue("vertical-align"),"super":"super"==g.getPropertyValue("vertical-align"),background:g.getPropertyValue("background-color"),alignment:g.getPropertyValue("text-align")};e.$emit("cursor-position",i)}},100,!0)}),e.range=null,e.getSelection=function(){if(k.getSelection){var a=k.getSelection();a.getRangeAt&&a.rangeCount&&(e.range=a.getRangeAt(0))}},e.restoreSelection=function(){if(e.range&&k.getSelection){var a=k.getSelection();a.removeAllRanges(),a.addRange(e.range)}},e.$on("execCommand",function(a,b){console.log("execCommand: "),console.log(b),h[0].contentDocument.body.focus();var c=k.selection;if(c){var d=c.createRange();k.execCommand(b.command,0,b.arg),d.collapse(!1),d.select()}else k.execCommand(b.command,0,b.arg);k.body.focus(),e.sync()}),e.$on("insertElement",function(a,b){var c,d;if(k.defaultView.getSelection){if(c=k.defaultView.getSelection(),c.getRangeAt&&c.rangeCount){d=c.getRangeAt(0),d.deleteContents();var f=k.createElement("div");f.innerHTML=b;for(var g,h,i=k.createDocumentFragment();g=f.firstChild;)h=i.appendChild(g);i.firstChild,d.insertNode(i),h&&(d=d.cloneRange(),d.setStartAfter(h),d.collapse(!0),c.removeAllRanges(),c.addRange(d))}}else k.selection&&"Control"!=k.selection.type&&k.selection.createRange().pasteHTML(b);e.sync()}),e.$on("$destroy",function(){});try{k.execCommand("styleWithCSS",0,0),k.execCommand("enableObjectResizing",!1,"false"),k.execCommand("contentReadOnly",0,"false")}catch(o){try{k.execCommand("useCSS",0,1)}catch(o){}}};return{link:h,require:"ngModel",scope:{config:"=ngpContentFrame"},replace:!0,restrict:"AE"}}]),a.module("ngWYSIWYG").directive("ngpResizable",["$document",function(a){return function(b,c){var d=a[0],e=c[0],f=d.createElement("span");f.className="resizer",e.appendChild(f),f.addEventListener("mousedown",function(){function a(a){a.preventDefault();var b=a.pageY;a.view!=d.defaultView&&(b=a.pageY+a.view.frameElement.getBoundingClientRect().top+d.defaultView.pageYOffset);var c=b-(e.getBoundingClientRect().top+d.defaultView.pageYOffset),f=e.style.height.replace("px","");f&&c>f&&window.innerHeight-a.clientY<=45&&d.defaultView.scrollBy(0,c-f),e.style.height=c+"px"}function b(){d.removeEventListener("mousemove",a),d.removeEventListener("mouseup",b);for(var c=d.querySelectorAll("iframe"),e=0;e<c.length;e++)c[e].contentWindow.document.removeEventListener("mouseup",b),c[e].contentWindow.document.removeEventListener("mousemove",a)}d.addEventListener("mousemove",a),d.addEventListener("mouseup",b);for(var c=d.querySelectorAll("iframe"),f=0;f<c.length;f++)c[f].contentWindow.document.addEventListener("mouseup",b),c[f].contentWindow.document.addEventListener("mousemove",a)})}}]),a.module("ngWYSIWYG").service("ngpUtils",[function(){var a=this;a.getSelectionBoundaryElement=function(a,b){var c,d,e=null,f=a.document;return f.selection?(c=f.selection.createRange(),c.collapse(b),c.parentElement()):(f.getSelection?(d=f.getSelection(),d.rangeCount>0&&(c=d.getRangeAt(0),e=c[b?"startContainer":"endContainer"],3===e.nodeType&&(e=e.parentNode))):a.getSelection&&(d=a.getSelection(),d.rangeCount>0&&(c=d.getRangeAt(0),e=c[b?"startContainer":"endContainer"],3===e.nodeType&&(e=e.parentNode))),e)}}]),"ngWYSIWYG"});